<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å {{ page_name }} | AiHome</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding: 20px;
            background: #1a1a1a;
            border-radius: 12px;
        }

        h1 {
            font-size: 28px;
            color: #a855f7;
        }

        .back-btn {
            padding: 10px 24px;
            background: #333;
            color: #fff;
            text-decoration: none;
            border-radius: 8px;
            font-size: 14px;
            transition: 0.3s;
        }

        .back-btn:hover {
            background: #444;
        }

        .edit-form {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-size: 16px;
            font-weight: 600;
            color: #a855f7;
        }

        textarea {
            width: 100%;
            min-height: 400px;
            padding: 15px;
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 8px;
            color: #fff;
            font-size: 15px;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            resize: vertical;
            transition: 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #a855f7;
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .btn {
            padding: 12px 32px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: 0.3s;
            position: relative;
        }

        .btn-primary {
            background: #a855f7;
            color: #fff;
        }

        .btn-primary:hover:not(:disabled) {
            background: #c084fc;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #333;
            color: #fff;
        }

        .btn-secondary:hover {
            background: #444;
        }

        .info-box {
            background: #1a1a1a;
            border-left: 4px solid #a855f7;
            padding: 15px 20px;
            margin-bottom: 25px;
            border-radius: 8px;
        }

        .info-box p {
            color: #888;
            font-size: 14px;
            line-height: 1.6;
        }

        .char-counter {
            text-align: right;
            color: #666;
            font-size: 13px;
            margin-top: 8px;
        }

        .success-message {
            background: #10b981;
            color: #fff;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            animation: slideIn 0.3s ease;
        }

        .success-message.show {
            display: block;
        }

        .debug-info {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-size: 12px;
            color: #666;
        }

        .debug-info pre {
            margin: 5px 0;
            color: #888;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 22px;
            }

            header {
                flex-direction: column;
                gap: 15px;
            }

            .edit-form {
                padding: 20px;
            }

            textarea {
                min-height: 300px;
                font-size: 14px;
            }

            .form-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å: {{ page_name }}</h1>
            <a href="/admin" class="back-btn">‚Üê –ù–∞–∑–∞–¥ –∫ –ø–∞–Ω–µ–ª–∏</a>
        </header>

        <div id="successMessage" class="success-message">
            ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!
        </div>

        <div class="info-box">
            <p>üí° <strong>–°–æ–≤–µ—Ç:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTML —Ç–µ–≥–∏ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞:</p>
            <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
                <li><code>&lt;h2&gt;–¢–µ–∫—Å—Ç&lt;/h2&gt;</code> ‚Äî –±–æ–ª—å—à–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫</li>
                <li><code>&lt;h3&gt;–¢–µ–∫—Å—Ç&lt;/h3&gt;</code> ‚Äî —Å—Ä–µ–¥–Ω–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫</li>
                <li><code>&lt;p&gt;–¢–µ–∫—Å—Ç&lt;/p&gt;</code> ‚Äî –∞–±–∑–∞—Ü —Ç–µ–∫—Å—Ç–∞</li>
                <li><code>&lt;strong&gt;–¢–µ–∫—Å—Ç&lt;/strong&gt;</code> ‚Äî –∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç</li>
                <li><code>&lt;em&gt;–¢–µ–∫—Å—Ç&lt;/em&gt;</code> ‚Äî –∫—É—Ä—Å–∏–≤–Ω—ã–π —Ç–µ–∫—Å—Ç</li>
                <li><code>&lt;br&gt;</code> ‚Äî –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏</li>
                <li><code>&lt;a href="—Å—Å—ã–ª–∫–∞"&gt;–¢–µ–∫—Å—Ç&lt;/a&gt;</code> ‚Äî —Å—Å—ã–ª–∫–∞</li>
                <li><code>&lt;ul&gt;&lt;li&gt;–ü—É–Ω–∫—Ç&lt;/li&gt;&lt;/ul&gt;</code> ‚Äî –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫</li>
                <li><code>&lt;ol&gt;&lt;li&gt;–ü—É–Ω–∫—Ç&lt;/li&gt;&lt;/ol&gt;</code> ‚Äî –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫</li>
            </ul>
            <p style="margin-top: 15px; color: #fca5a5;">‚ö†Ô∏è –ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å —Ç–µ–≥–∏! –ù–∞–ø—Ä–∏–º–µ—Ä:
                <code>&lt;p&gt;—Ç–µ–∫—Å—Ç&lt;/p&gt;</code></p>
        </div>

        <form method="POST" action="" class="edit-form" id="editForm">
            <div class="form-group">
                <label for="text_new">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:</label>
                <textarea name="text_new" id="text_new" required
                    placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã...">{{ text.text_new if text else '' }}</textarea>
                <div class="char-counter">
                    –°–∏–º–≤–æ–ª–æ–≤: <span id="charCount">0</span>
                </div>
            </div>

            <div class="form-actions">
                <a href="/admin" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
                <button type="submit" class="btn btn-primary" id="saveBtn">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                </button>
            </div>
        </form>

        <!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ) -->
        <div class="debug-info">
            <strong>üîç –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong>
            <pre>ID —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {{ text.id if text else 'N/A' }}</pre>
            <pre>–ù–∞–∑–≤–∞–Ω–∏–µ: {{ page_name }}</pre>
            <pre>–¢–µ–∫—É—â–∞—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞: <span id="currentLength">{{ text.text_new|length if text else 0 }}</span> —Å–∏–º–≤–æ–ª–æ–≤</pre>
        </div>
    </div>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const form = document.getElementById('editForm');
        const textarea = document.getElementById('text_new');
        const charCount = document.getElementById('charCount');
        const saveBtn = document.getElementById('saveBtn');
        const successMessage = document.getElementById('successMessage');
        const currentLength = document.getElementById('currentLength');

        // –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤
        function updateCharCount() {
            const length = textarea.value.length;
            charCount.textContent = length;
            currentLength.textContent = length;

            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            if (length > 0) {
                textarea.style.borderColor = '#a855f7';
            }
        }

        textarea.addEventListener('input', updateCharCount);
        updateCharCount(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        form.addEventListener('submit', function (e) {
            console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã...');
            console.log('üìù –¢–µ–∫—Å—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', textarea.value.substring(0, 100) + '...');
            console.log('üìè –î–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞:', textarea.value.length);

            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ
            saveBtn.disabled = true;
            saveBtn.textContent = '‚è≥ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';

            // –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ, Flask —Å–¥–µ–ª–∞–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç
            // –≠—Ç–æ—Ç –∫–æ–¥ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥–µ—Ç –Ω–µ —Ç–∞–∫
            setTimeout(() => {
                saveBtn.disabled = false;
                saveBtn.textContent = 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
            }, 3000);
        });

        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —É—Ö–æ–¥–æ–º —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
        let initialValue = textarea.value;
        let formSubmitted = false;

        form.addEventListener('submit', function () {
            formSubmitted = true;
        });

        window.addEventListener('beforeunload', function (e) {
            if (textarea.value !== initialValue && !formSubmitted) {
                e.preventDefault();
                e.returnValue = '–£ –≤–∞—Å –µ—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è. –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–∫–∏–Ω—É—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É?';
                return e.returnValue;
            }
        });

        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ —Å–±–æ–µ
        textarea.addEventListener('input', function () {
            localStorage.setItem('draft_{{ text.id if text else 0 }}', textarea.value);
        });

        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function () {
            const draft = localStorage.getItem('draft_{{ text.id if text else 0 }}');
            if (draft && draft !== textarea.value && confirm('–ù–∞–π–¥–µ–Ω –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —á–µ—Ä–Ω–æ–≤–∏–∫. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å?')) {
                textarea.value = draft;
                updateCharCount();
            }
        });

        // –û—á–∏—Å—Ç–∫–∞ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
        form.addEventListener('submit', function () {
            localStorage.removeItem('draft_{{ text.id if text else 0 }}');
        });

        console.log('‚úÖ –†–µ–¥–∞–∫—Ç–æ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        console.log('üìÑ ID —Ç–µ–∫—Å—Ç–∞:', '{{ text.id if text else "N/A" }}');
        console.log('üìù –ù–∞—á–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞:', textarea.value.length);
    </script>
</body>

</html>